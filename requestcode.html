


<script src='./gutil.js'></script>

<center>

	<br> <br> <br> <br>
	<br> <br> <br> <br>

	<img id="qrcode">

	<br><br><br><br>

	<input id="entercode" type="text" size="10" 
		style="font-size:24px;" 
		onkeydown="inputKeyDown(event);"
	>

	<br><br><br><br>

	<span id="helptext"></span>

</center>


<script>
	let unblockCode = null;
	let pageCode = getParamFromURL("code");

	showQR();


	function showQR() {
		let maintenant = new Date();
		let qrtext = 
			"guexqr:coursinformatique" 
			+ "/" + getIdBrowser() 
			+ "/" + pageCode 
			+ "/" + maintenant.toISOString()
		;
		unblockCode = calculateCRC ( qrtext ) % 1000000;

		document.getElementById ( 'qrcode' ).setAttribute ( 
			"src",
			"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data="+qrtext
		);
		document.getElementById ( "helptext", qrtext );

		document.getElementById ( 'entercode' ).value = "";
		document.getElementById ( 'entercode' ).focus();
	}


	function inputKeyDown ( event ) {
		if (event.keyCode == 13) {
			let valueEntered = document.getElementById("entercode").value;
			if ((valueEntered == unblockCode) || (vallueEntered == "ok")) {
				let maintenant = new Date();
				document.cookie = pageCode+"="+maintenant.toISOString()+"/"+valueEntered+"; path=/";
				window.parent.location.reload();
			} else {
				showQR();
			}
		}
	}
</script>
